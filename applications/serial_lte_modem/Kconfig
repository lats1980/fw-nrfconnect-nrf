#
# Copyright (c) 2019 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

source "Kconfig.zephyr"

menu "Nordic Serial LTE Modem"

config SLM_AT_MODE
	bool "Serial LTE Modem by raw AT mode"
	default y
	select AT_CMD
	select AT_NOTIF
	select AT_CMD_PARSER

config SLM_AT_MAX_PARAM
	int "Maximum number of parameters in AT command"
	default 9

config SLM_NATIVE_TLS
	bool "Use Zephyr mbedTLS"

config SLM_WATCHDOG
	bool "Watchdog support in SLM"
	default y
	select WATCHDOG

config SLM_WATCHDOG_TIMEOUT_MSEC
	int "Watchdog timeout in milliseconds"
	default 60000

config SLM_UI
	bool "Enable SLM UI"
	default y

config SLM_DIAG
	bool "Enable SLM diagnostic module"

config SLM_UART_HWFC_RUNTIME
	bool "Support of UART HWFC runtime configuration"

#
# external XTAL for UART
#
config SLM_EXTERNAL_XTAL
	bool "Use external XTAL for UARTE"
	default y

#
# Inter-Connect
#
choice
	prompt "UART for interconnect"
	default SLM_CONNECT_UART_0
	help
		Selects which UART to use for interconnect:
		-  UART 0
		-  UART 2
	config SLM_CONNECT_UART_0
		bool "UART 0"
	  select UART_0_NRF_HW_ASYNC
	  select SLM_UART_HWFC_RUNTIME if $(dt_node_has_prop,uart0,rts-pin) && \
					  $(dt_node_has_prop,uart0,cts-pin)
	config SLM_CONNECT_UART_2
		bool "UART 2"
	  select UART_2_NRF_UARTE
	  select UART_2_NRF_HW_ASYNC
	  select SLM_UART_HWFC_RUNTIME if $(dt_node_has_prop,uart2,rts-pin) && \
					  $(dt_node_has_prop,uart2,cts-pin)
endchoice

choice
	prompt "Termination mode"
	default SLM_CR_LF_TERMINATION
	help
		Sets the command terminator used by the serial terminal.
		Available options are:
		-  CR termination
		-  LF termination
		-  CR+LF termination
	config SLM_CR_TERMINATION
		bool "CR termination"
	config SLM_LF_TERMINATION
		bool "LF termination"
	config SLM_CR_LF_TERMINATION
		bool "CR+LF termination"
endchoice

#
# GPIO wakeup
#
config SLM_GPIO_WAKEUP
	bool "Support of GPIO wakeup"
	default y
	help
	  Enable GPIO wakeup on nRF9160 side.

if SLM_GPIO_WAKEUP

config SLM_START_SLEEP
	bool "Enter sleep on start-up"
	help
	  nRF91 start up then enter deep sleep.

endif

config SLM_INTERFACE_PIN
	int "Interface GPIO to wake up or exit idle mode"
	default 6 if SLM_CONNECT_UART_0
	default 31 if SLM_CONNECT_UART_2

config SLM_UI_LTE_STATE
	bool "LTE connection state pin option"
	default y
	help
	  This is an option to enable GPIO pin as LTE state indicator.

config SLM_UI_LTE_STATE_PIN
	int "LTE connection state pin"
	default 2
	help
	  Default GPIO pin as LTE state indicator.

config SLM_UI_DATA_ACTIVITY
	bool "Data pin option"
	default y
	help
	  This is an option to enable GPIO pin as data indicator.

config SLM_UI_DATA_ACTIVITY_PIN
	int "Data activity pin"
	default 3
	help
	  Default GPIO pin as data activity indicator.

config SLM_UI_LTE_SIGNAL
	bool "LTE signal strength pin option"
	default y
	help
	  This is an option to enable GPIO pin as LTE signal indicator.

config SLM_UI_LTE_SIGNAL_PIN
	int "LTE signal strength pin"
	default 4
	help
	  Default GPIO pin as LTE signal strength indicator.

config SLM_UI_DIAG
	bool "SLM diagnostic pin option"
	default y
	help
	  This is an option to enable GPIO pin as SLM diagnostic indicator.

config SLM_UI_DIAG_PIN
	int "SLM diagnostic pin"
	default 5
	help
	  Default GPIO pin as SLM diagnostic indicator.

config SLM_RI_PIN
	int "Ring Indicator Pin"
	default 20

config SLM_MOD_FLASH
	bool "modem flash pin option"
	default y
	help
	  This is an option to enable GPIO pin as modem flash indicator.

config SLM_MOD_FLASH_PIN
	int "MOD_FLASHLED Pin"
	default 10

config SLM_DCD_PIN
	int "DCD Pin"
	default 26

config SLM_RI_ON_DURATION
	int "Duration of the Ring Indicator Pin to be turned on in ms"
	default 1500

config SLM_RI_OFF_DURATION
	int "Duration of the Ring Indicator Pin to be turned off in ms"
	default 1500

config SLM_POST_RI_DURATION
	int "Duration of the wait after Ring Indicator to send URC"
	default 500

#
# Socket
#
config SLM_SOCKET_RX_MAX
	int "Maximum RX buffer size for receiving socket data"
	range 576 708
	default 576
	help
	  Default: NET_IPV4_MTU (576)
	  Maximum: MSS setting in modem (708)

#
# TCP/TLS proxy
#
config SLM_TCP_FILTER_SIZE
	int "Size of IPv4 address allowlist"
	range 1 6
	default 6

config SLM_TCP_POLL_TIME
	int "Poll time-out in seconds for TCP connection"
	default 10

config SLM_UDP_POLL_TIME
	int "Poll time-out in seconds for UDP connection"
	default 10

config SLM_TCP_CONN_TIME
	int "Connection time-out in seconds for TCP server"
	default 60

config SLM_DATAMODE_HWFC
	bool "UART HWFC for data mode"
	default y
	help
	  Require UART hardware flow control for data mode

config SLM_DATAMODE_TERMINATOR
	string "Pattern string to terminate data mode"
	default "+++"
	help
	  Use a pattern to terminate data mode

config SLM_DATAMODE_SILENCE
	int "Silence time to exit data mode"
	default 1
	help
	  Exit data mode after the specified time (in seconds) of UART silence

#
# Configurable services
#
rsource "src/gps/Kconfig"
rsource "src/ftp_c/Kconfig"
rsource "src/mqtt_c/Kconfig"
rsource "src/http_c/Kconfig"
rsource "src/stats/Kconfig"
rsource "src/twi/Kconfig"
rsource "src/gpio/Kconfig"
rsource "src/user_config/Kconfig"
rsource "src/hw_rev/Kconfig"

module = SLM
module-str = serial modem
source "${ZEPHYR_BASE}/subsys/logging/Kconfig.template.log_config"

endmenu
